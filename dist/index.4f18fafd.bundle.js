!function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);o(1);let n=function(e,t){let o=null;return function(){o&&clearTimeout(o),o=setTimeout(e,t)}}(function(){let e=$(".item:last-child"),t=parseInt(e[0].style.top)+e[0].clientHeight;$("#masonry").height(t)},300);function s(){var e=$(".container").offset().width-18,t=parseInt(e/2);$(".item").width(t);var o=[];$(".masonry .item").each(function(e){var n=$(this).height(),s=$(this).width(),a=parseInt(n*(t/s))+15;if(e<2)$(this).css({opacity:1,top:0,left:t*e+6*(e+1)}),o.push(a);else{for(var i=o[0],r=0,l=0;l<o.length;l++)i>o[l]&&(i=o[l],r=l);$(this).css({opacity:1,top:o[r],left:$(".masonry .item").eq(r).css("left")}),o[r]=o[r]+a}}),n()}window.loadimg=function(){s()},window.errorImg=function(){s()},{loadingComponent:null,masonry:null,isLoading:!1,searchInput:null,searchBtn:null,timeEle:null,endDate:(15651072e5-(new Date).getTime())/1e3,timer:null,infoEle:null,loginBox:null,loadingBox:null,userInfo:!1,isNodata:!1,voteCountBox:null,searchParam:{keyword:"动漫",from:0,count:15},init(){this.masonry=$("#masonry"),this.loadingComponent=$("#loading"),this.searchBtn=$("#searchBtn"),this.searchInput=$("#searchInput"),this.timeEle=$(".c_d_time")[0],this.infoEle=$("#info"),this.loginBox=$("#loginBox"),this.loadingBox=$("#loadingBox"),this.voteCountBox=$("#voteCount"),this.visit(),this.checkLogin(),this.bindEvent(),this.loadData(),this.countDown()},bindEvent(){let e=this;e.searchBtn.on("click",function(){e.masonry.html(""),e.masonry.css({height:0}),e.searchParam={keyword:e.searchInput[0].value,from:1,count:20},e.testData()}),$(".btn").live("click",function(){let t=$(this);if(e.endDate<=0)return void e.showMessage("info","投票已过期",1400);if(t.hasClass("inactive"))return void e.showMessage("info","不能重复投票哦",1400);if(5===e.userInfo.vote_record.length)return void e.showMessage("info","您已经没有票数啦",1400);let o=t.siblings("p").children("span"),n=o.text();o.text(+n+1),t.addClass("inactive"),t.text("已投票"),e.showMessage("","投票成功",1400),e.voteCountBox.text(+e.voteCountBox.text()-1),e.vote(e.userInfo.id,t.attr("item"),o,t)}),$("#loginBox button").on("click",function(){let t=$.trim($("#loginBox input")[0].value);t?e.login(t):e.showMessage("error","请输入姓名",1500)}),$("#loginBox input").on("keyup",function(t){if(13!==t.keyCode)return;let o=$.trim($("#loginBox input")[0].value);o?e.login(o):e.showMessage("error","请输入姓名",1500)}),$("#logout").on("click",function(){localStorage.removeItem("userInfo"),e.loginBox.addClass("show")})},transTime(e){let t=e%86400,o=t%3600;return{days:Math.floor(e/86400),hours:Math.floor(t/3600),mins:Math.floor(o/60),senC:Math.floor(o%60)}},countDown(){let e=this;if(console.log(e.endDate),this.endDate=this.endDate-1,this.endDate<=0)return clearTimeout(this.timer),this.timer=null,this.endDate=0,void $(e.timeEle).html("\n        <span>0 </span>天 \n        <span>0 </span>时 \n        <span>0 </span>分 \n        <span>0 </span>秒 \n    ");let{days:t,hours:o,mins:n,senC:s}=this.transTime(this.endDate);$(e.timeEle).html(`\n        <span>${t} </span>天 \n        <span>${o} </span>时 \n        <span>${n} </span>分 \n        <span>${s} </span>秒 \n    `),this.timer=setTimeout(function(){e.countDown()},1e3)},loadData(){let e=this;this.isLoading||(this.isLoading=!0,this.hideNoData(),this.showLoading(e),$.ajax({type:"get",dataType:"json",url:"/litong/public/index.php/index/index/voter",success(t){let o=JSON.parse(t).data,n="";for(let t=0,s=o.length;t<s;t++){let s=o[t];n+=e.assemblyTemplate(s)}e.excuAppend(e,n)},error(t){e.isLoading=!1,e.hideLoading(e),e.showNoData()}}))},testData(){let e=this,{from:t,count:o,keyword:n}=this.searchParam;this.isLoading||(this.isLoading=!0,this.showLoading(e),$.ajax({type:"get",dataType:"json",url:`/sf/vsearch/image/search/wisesearchresult?tn=wisejsonala&ie=utf-8&fromsf=1&word=${n}&pn=${t}&rn=${o}&gsm=1e&searchtype=0&prefresh=undefined&fromfilter=0`,success(t){let o=t.linkData,n="",s=0;for(let t=0,a=o.length;t<a;t++){let i=o[t],r=new Image;r.src=i.hoverUrl,r.onload=function(){s++,n+=e.assemblyTemplate(i),e.excuAppend(s,a,e,n)},r.onerror=function(){console.log(r.src),i.hoverUrl="assets/image/shootcut.png",n+=e.assemblyTemplate(i),s++,e.excuAppend(s,a,e,n)}}},error(t){e.isLoading=!1,e.hideLoading(e)}}))},assemblyTemplate:e=>`<div class="item">\n        <span class="label">${e.id}</span>\n        <img class="lazy" onload="loadimg()" onerror="errorImg()" src=${e.image} alt=" "/>\n        <p class = "name">${e.name}</p>\n        <p class="dep" >${e.department}--${e.position} </p>\n        <p class="txt">获奖情况：<br>${e.jiang}</p>\n        <p class="txt">个人简介：<br>${e.des}</p>\n        \n        <div class="operation">\n            <p><span>${e.votes}</span> 票</p>\n            <button item=${e.id} class="btn">投他一票</button>\n        </div>\n    </div>`,showLoading(e){e.loadingComponent.addClass("show")},hideLoading(e){e.loadingComponent.removeClass("show")},excuAppend(e,t){e.masonry.append(t),e.isLoading=!1,e.hideLoading(e),setTimeout(()=>{e.userInfo&&e.changeStatus(e)},200)},showMessage(e,t,o){let n=document.createElement("div");$(n).text(t),$(n).addClass(`info ${e}`),document.body.appendChild(n),$(n).addClass("show"),setTimeout(()=>{document.body.removeChild(n)},o)},checkLogin(){let e=localStorage.userInfo?JSON.parse(localStorage.userInfo):null;e||this.loginBox.hasClass("show")||this.loginBox.addClass("show"),e&&(this.userInfo=e,this.login(this.userInfo.name))},showLoadingBox(){this.loadingBox.hasClass("show")||this.loadingBox.addClass("show")},hideLoadingBox(){this.loadingBox.hasClass("show")&&this.loadingBox.removeClass("show")},login(e){let t=this;localStorage.userInfo||t.showLoadingBox(),localStorage.removeItem("userInfo"),this.userInfo=null,$.ajax({type:"post",dataType:"json",url:`/litong/public/index.php/index/index/login?name=${e}`,success(e){t.hideLoadingBox();let o=JSON.parse(e);1==o.code?(localStorage.userInfo=JSON.stringify(o.data),t.userInfo=o.data,t.loginBox.hasClass("show")&&t.loginBox.removeClass("show"),t.showMessage("success","登录成功",2e3),t.voteCountBox.text(5-t.userInfo.vote_record.length),t.changeStatus(t)):t.showMessage("error",o.msg,2e3)},error(e){t.hideLoadingBox(),t.showMessage("error","网络链接失败，请稍后重试",4e3)}})},vote(e,t,o,n){let s=this;$.ajax({type:"post",dataType:"json",url:`/litong/public/index.php/index/index/vote?nid=${e}&id=${t}`,success(e){let t=JSON.parse(e);1==t.code?(s.userInfo.vote_record=t.data,localStorage.userInfo=JSON.stringify(s.userInfo),s.visit()):(s.showMessage("error",t.msg,2e3),0==t.code||2==t.code&&(n.removeClass("inactive"),n.text("投他一票")),s.userInfo.vote_record=t.data,localStorage.userInfo=JSON.stringify(s.userInfo),o.text(+o.text()-1),s.voteCountBox.text(+s.voteCountBox.text()+1))},error(e){o.text(+o.text()-1),s.showMessage("error","投票失败，请再投一次",2e3),n.removeClass("inactive"),n.text("投他一票"),s.voteCountBox.text(+s.voteCountBox.text()+1)}})},visit(){let e=this;$.ajax({type:"get",dataType:"json",url:"/litong/public/index.php/index/index/visit",success(e){let t=JSON.parse(e);1==t.code&&($("#v_count").text(t.data.u),$("#u_count").text(t.data.v),$("#l_count").text(t.data.l))},error(t){e.showMessage("error","网络链接失败，请刷新页面",2e3)}})},showNoData(){!$("#noData").hasClass("show")&&$("#noData").addClass("show"),this.isNodata=!0},hideNoData(){$("#noData").hasClass("show")&&$("#noData").removeClass("show"),this.isNodata=!1},changeStatus(e){$(".btn").forEach(t=>{let o=$(t);e.userInfo.vote_record.forEach(e=>{e.vid==o.attr("item")&&(o.hasClass("inactive")||(o.addClass("inactive"),o.text("已投票")))})})}}.init()},function(e,t){}]);